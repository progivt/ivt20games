<!doctype html>
<head>
	<meta charset="utf-8">
	<title>HTML5 Sortable library</title>
	<link rel="stylesheet" href="basscss.css">
	<script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
	<script src="html5sortable.js"></script>
</head>
<body>
	<div class="px2 sm-px3 py2 mb3 col-8 mx-auto">
		<section class="mb3 mx-auto col col-12">
			<div class="p3 clearfix bg-navy yellow">
				<div class="col col-5">
					<h2 class="h3 m0 white">Голосование за игры</h2>
					<p class="mt2 yellow">
					Расположите проекты перетаскиванием. Выше означает лучше. 
					</p>
					<p class="mt2 yellow">
					Не беспокойтесь слишком сильно о&nbsp;точности расстановки,
					разница в 1–2 места будет почти незаметна в баллах
					</p>
					<p class="mt2 yellow">
					Игры можно посмотреть в действии <a href="https://progivt.github.io/docs/js06game/">тут.</a>
					</p>
					<p class="mt2 yellow">
					Когда все будет готово, нажмите кнопку «Готово, получить код» и скопируйте 
					появившийся внизу код в гугл-форму голосования.</a>
					</p>
					</div>
				<div class="col col-7">
					<ul class="ml4 js-sortable sortable list flex flex-column list-reset">
						<li id="li01" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="01.png"> Flappy SVFU</li>
						<li id="li02" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="02.png"> Змейка 1 (пиу/dorime)</li>
						<li id="li03" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="03.png"> SpaceWars</li>
						<li id="li04" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="04.png"> Змейка 2</li>
						<li id="li05" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="05.png"> Змейка 3 (с яблоками)</li>
						<li id="li06" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="06.png"> Эльф (платформер)</li>
						<li id="li07" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="07.png"> Белый медвежонок</li>
						<li id="li08" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="08.png"> Зубочистка</li>
						<li id="li09" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="09.png"> Злая пуля и мечи</li>
						<li id="li10" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="10.png"> Корейцы ищут хомус</li>
						<li id="li11" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="11.png"> Зомби в КФЕНе</li>
						<li id="li12" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="12.png"> Олонхо</li>
						<li id="li13" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="13.png"> Новелла Второй шанс</li>
						<li id="li14" class="flex flex-center p1 mb1 navy bg-yellow border border-yellow" style="position: relative; z-index: 10"><img width="64" height="64" src="14.png"> Первый день в кфене</li>
					</ul>
					<button class="ml4 js-serialize-button button navy bg-yellow">Готово, получить код!</button>
				</div>
			</div>
			<script type="text/javascript">
				sortable('.js-sortable', {
					forcePlaceholderSize: true,
					placeholderClass: 'mb1 bg-navy border border-yellow border-dashed',
					hoverClass: 'bg-maroon yellow',
					itemSerializer: function (item, container) {
						item.parent = ''
						item.id = item.node.id.slice(-2)
						item.node = ''
						return item
					},
	  				containerSerializer: function (container) {
						return null;
					}
				})
				document.querySelector('.js-serialize-button').addEventListener('click', function () {
					let serialized = sortable('.js-sortable', 'serialize')
					let code = serialized[0]['items'].map(item => item.id).join('-')  
	  				document.querySelector('.serialized-content').innerHTML = code
				})

				function fallbackCopyTextToClipboard() {
					var textArea = document.getElementById("rankingcode");
					textArea.focus();
					textArea.select();
					try {
						var successful = document.execCommand('copy');
					} catch (err) {
						return false;
					}
					return true;
				}
				function copyTextToClipboard() {
					let result = true;
					if (!navigator.clipboard) {
						return fallbackCopyTextToClipboard();
					}
					navigator.clipboard.writeText(document.getElementById("rankingcode").value).then(function() {;
					}, function(err) {
						console.error('Async: Could not copy text: ', err);
						result = fallbackCopyTextToClipboard();
					});
					return result;
				}
				function tryCopy(){
					let text = document.querySelector('#rankingcode');
					if (text.value.trim()){
						text.focus();
						if (copyTextToClipboard()) alert('Код скопирован, вставьте его в Гугл форму!')
					}
				}
			</script>
			<div class="p2 bg-yellow border-top navy border-yellow">
				<h5>Код:</h5>
				<textarea id="rankingcode" cols="80" rows="1" class="serialized-content">
				</textarea>
				<img id="copyicon" style="width:2rem; height: 2rem;" src="copy.png" onclick="tryCopy();">
			</div>
		</section>
	</div>
	<script>
		sortable('.js-sortable-copy', {
			forcePlaceholderSize: true,
			copy: true,
			acceptFrom: false,
			placeholderClass: 'mb1 bg-navy border border-yellow border-dashed',
		});
		sortable('.js-sortable-copy-target', {
			forcePlaceholderSize: true,
			acceptFrom: '.js-sortable-copy,.js-sortable-copy-target',
			placeholderClass: 'mb1 border border-maroon',
		});
		sortable('.js-grid', {
			forcePlaceholderSize: true,
			placeholderClass: 'col col-4 border border-maroon'
		});
		sortable('.js-sortable-connected', {
			forcePlaceholderSize: true,
			connectWith: '.js-connected',
			handle: '.js-handle',
			items: 'li',
			placeholderClass: 'border border-white bg-orange mb1'
		});
		sortable('.js-sortable-inner-connected', {
			forcePlaceholderSize: true,
			connectWith: 'js-inner-connected',
			handle: '.js-inner-handle',
			items: '.item',
			maxItems: 3,
			placeholderClass: 'border border-white bg-orange mb1'
		});
		sortable('.js-sortable-buttons', {
			forcePlaceholderSize: true,
			items: 'li',
			placeholderClass: 'border border-white mb1',
			hoverClass: 'bg-yellow'
		});
	</script>
</body>
